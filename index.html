<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EmoCode èª­ã¿å–ã‚Šï¼†ç”Ÿæˆ</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f5f5f5;
      margin: 0; padding: 0;
      display: flex; flex-direction: column; align-items: center;
    }
    h1 { margin-top: 1rem; color: #444; }
    video, canvas {
      width: 90%; max-width: 400px; margin-top: 1rem;
      border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .controls, .plugins, .output, .history {
      margin: 1rem; padding: 1rem;
      background: white; border-radius: 1rem;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      width: 90%; max-width: 600px;
    }
    label { display: block; margin-bottom: 0.5rem; }
    textarea, input[type="text"] {
      width: 100%; padding: 0.5rem; border-radius: 8px;
      border: 1px solid #ccc; font-family: monospace;
    }
    .emoji-output, .log { margin-top: 1rem; white-space: pre-wrap; word-break: break-word; }
  </style>
</head>
<body>
  <h1>ğŸ“· EmoCode Scanner & Generator</h1>
  <video id="video" autoplay playsinline></video>
  <canvas id="canvas" style="display:none;"></canvas>  <div class="controls">
    <label for="textInput">ğŸ”¤ å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰çµµæ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ:</label>
    <input type="text" id="textInput" placeholder="https://example.com">
    <button onclick="generateCode()">ç”Ÿæˆ</button>
    <div class="emoji-output" id="emojiOutput"></div>
  </div>  <div class="plugins">
    <label><input type="checkbox" id="pluginPoem"> EmoPoem</label>
    <label><input type="checkbox" id="pluginDNA"> EmoDNA</label>
    <label><input type="checkbox" id="pluginAuth"> EmoAuth (RSAæš—å·)</label>
    <label><input type="checkbox" id="pluginTime"> EmoTimeLock</label>
    <label><input type="checkbox" id="pluginTicket"> EmoTicket</label>
  </div>  <div class="output">
    <strong>ğŸ§  OCRçµæœï¼š</strong>
    <div class="log" id="ocrLog"></div>
  </div>  <div class="history">
    <strong>ğŸ“ èª­ã¿å–ã‚Šå±¥æ­´:</strong>
    <div class="log" id="historyLog"></div>
  </div>  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5.0.0/dist/tesseract.min.js"></script>  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const ocrLog = document.getElementById('ocrLog');
    const emojiOutput = document.getElementById('emojiOutput');
    const historyLog = document.getElementById('historyLog');

    // çµµæ–‡å­—ã‚»ãƒƒãƒˆï¼ˆä¾‹: Unicodeç¯„å›²ã‹ã‚‰å‹•çš„å–å¾—ã‚‚å¯ï¼‰
    const emojiSet = [..."ğŸ˜€ğŸ˜ƒğŸ˜„ğŸ˜ğŸ˜†ğŸ˜…ğŸ˜‚ğŸ¤£ğŸ˜ŠğŸ˜‡ğŸ™‚ğŸ™ƒğŸ˜‰ğŸ˜ŒğŸ˜ğŸ¥°ğŸ˜˜ğŸ˜—ğŸ˜™ğŸ˜šğŸ˜‹ğŸ˜›ğŸ˜ğŸ˜œğŸ¤ªğŸ¤¨ğŸ§ğŸ¤“ğŸ˜ğŸ¥³"];

    // ãƒ©ãƒ³ãƒ€ãƒ ã«çµµæ–‡å­—åˆ—ã‚’ç”Ÿæˆ
    function generateCode() {
      const input = document.getElementById('textInput').value;
      const enabledPlugins = {
        poem: document.getElementById('pluginPoem').checked,
        dna: document.getElementById('pluginDNA').checked,
        auth: document.getElementById('pluginAuth').checked,
        time: document.getElementById('pluginTime').checked,
        ticket: document.getElementById('pluginTicket').checked
      };

      let encoded = btoa(input);
      if (enabledPlugins.auth) {
        encoded = rsaEncrypt(encoded);
      }
      const emojis = encodeToEmojis(encoded);
      emojiOutput.textContent = emojis;
    }

    function encodeToEmojis(data) {
      let output = '';
      for (let i = 0; i < data.length; i++) {
        const index = data.charCodeAt(i) % emojiSet.length;
        output += emojiSet[index];
      }
      return output;
    }

    function rsaEncrypt(text) {
      // ä»®ã®RSAæš—å·å‡¦ç†ï¼ˆãƒ‡ãƒ¢ç”¨ã€å®Ÿéš›ã«ã¯WebCryptoã‚„JSEncryptã§å®Ÿè£…ï¼‰
      return text.split('').reverse().join('');
    }

    // ã‚«ãƒ¡ãƒ©åˆæœŸåŒ–
    navigator.mediaDevices.getUserMedia({ video: true })
      .then(stream => video.srcObject = stream)
      .catch(err => alert("ã‚«ãƒ¡ãƒ©ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“: " + err));

    // OCRèª­ã¿å–ã‚Š
    setInterval(async () => {
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      const { data: { text } } = await Tesseract.recognize(canvas, 'eng');
      if (text.trim()) {
        ocrLog.textContent = text.trim();
        if (!historyLog.textContent.includes(text.trim())) {
          historyLog.textContent += `\n${text.trim()}`;
        }
      }
    }, 5000);
  </script></body>
</html>
